define("km/app",["jquery","km/router","km/popTips","km/util","km/loading"],function(t,e,i,n,o){var r=function(e,n){this._route={},this._view=null,this._on={viewBeforeShow:[],viewAfterShow:[]},this.$el=e,this.config=t.extend({viewClass:"app-view",Template:null},n||{}),this.loading={show:function(){o.show()},hide:function(){o.hide()}},this.showTip=i};return r.prototype.on=function(t,e){return this._on.hasOwnProperty(t)&&this._on[t].push(e),this},r.prototype.off=function(t){return this._on.hasOwnProperty(t)&&(this._on[t]=[]),this},r.prototype.callView=function(e,i,n){var o,r=this;t.map(r._on.viewBeforeShow,function(t){t(e)}),n=n||function(){};var s=function(e){n(),t.map(r._on.viewAfterShow,function(t){t(e)})};if(null!==r._view){if(r._view.name===e)return r._view.instance.run(i),void s(r._view.instance);var a=r._view.instance;a.destroy()}r.loading.show();var u=function(n){r.loading.hide(),o=t('<div class="'+r.config.viewClass+'"></div>');var a=new n(o,r);a.run(i),r._view={name:e,instance:a},a.$el.appendTo(r.$el),s(r._view.instance)};"string"==typeof e?require([e],function(t){u(t)}):u(e)},r.prototype.route=function(t,e,i){return void 0===i&&(i=e,e={}),this._route[t]=[e,i],this},r.prototype.url=function(e){e=t.trim(e);for(var i in this._route){var n=this._route[i];if(e===n[1])return i}},r.prototype.run=function(){var t=this,i=new e;for(var n in t._route)!function(e){var n=t._route[e];i.map(e,n[0],function(e){t.callView(n[1],e||{})})}(n);i.init()},r.View=function(e,i){var n=this;this.$el=e,this.app=i,i.config.Template&&(this.Template=i.config.Template);var o=function(e,i,o){var r=t.Deferred();return t.ajax(i,{type:e,cache:!1,data:o||{},dataType:"json"}).done(function(t){t.state&&(t.Status=t.state,t.error&&(t.ErrorMessage=t.error),t.url&&(t.Url=t.url)),t.Status===!1?(n.app.loading.hide(),n.app.showTip.error(t.ErrorMessage||"发生未知错误",1e3),t.Url&&setTimeout(function(){window.location.href=t.Url},800)):r.resolve(t)}).fail(function(){n.app.loading.hide(),n.app.showTip.error("服务端发生错误了",1e3)}),r.promise()};this.http={get:function(t,e){return o("GET",t,e)},post:function(t,e){return o("POST",t,e)},put:function(t,e){return o("PUT",t,e)},head:function(t,e){return o("HEAD",t,e)},"delete":function(t,e){return o("DELETE",t,e)}}},r.View.prototype.when=function(){return t.when.apply(this,arguments)},r.View.prototype.run=function(t){this.context=t},r.View.prototype.destroy=function(){this.$el.remove()},r.View.extend=function(e){e=t.extend({initialize:function(){}},e||{});var i=e.initialize,o=function(t,e){this.superclass=r.View.prototype,this.superclass.initialize=r.View,i.call(this,t,e)};o.prototype=n.createProto(r.View.prototype),delete e.initialize;for(var s in e)o.prototype[s]=e[s];return o},r}),define("km/loading",["jquery"],function(t){var e={},i=t('<div class="km-loading"><i class="fa fa-spinner fa-spin"></i></div>').hide(),n=i.find(".fa-spin");return t(document.body).append(i),e.show=function(){i.fadeIn("fast").css({marginLeft:-(n.width()/2),marginTop:-(n.height()/2)})},e.hide=function(){i.fadeOut("fast")},e}),define("km/popTips",["jquery"],function(t){var e=function(){function e(){function e(e,r,s,a){o&&clearTimeout(o),t.isFunction(s)&&(a=s,s=3e3),a=a||t.noop,s=s||3e3,n&&n.stop().remove(),n=t(i(e,r)).appendTo(document.body),n.css({marginLeft:-(n.width()/2),marginTop:-(n.height()/2)}).fadeIn("fase",function(){o=setTimeout(function(){n.stop().remove(),a()},s)})}function i(t,e){var i=[];switch(t){case"success":i.push('<div class="km-pop-tips success"><span class="fa fa-check"></span>&nbsp;<span>'+e+"</span></div>");break;case"error":i.push('<div class="km-pop-tips error"><span class="fa fa-close"></span>&nbsp;<span>'+e+"</span></div>");break;case"warning":i.push('<div class="km-pop-tips warning"><span class="fa fa-exclamation"></span>&nbsp;<span>'+e+"</span></div>")}return i.join("")}var n,o;return{success:function(t,i,n){e("success",t,i,n)},error:function(t,i,n){e("error",t,i,n)},warning:function(t,i,n){e("warning",t,i,n)}}}var i;return{getInstance:function(){return i||(i=e()),i}}}();return e.getInstance()}),function(t){var e={addEventListener:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeEventListener:function(t,e){t.removeEventListener?t.removeEventListener(e,handler,!1):t.detachEvent?t.detachEvent("on"+e,handler):t["on"+e]=null},proxy:function(t,e){var i=function(){return t.apply(e||this,arguments)};return i}},i=function(){this._routes=[]};i.prototype.init=function(){var i=this;e.addEventListener(t,"hashchange",e.proxy(i.listener,this)),this.listener()},i.prototype.listener=function(){var t,e=location.hash.slice(1).split("?"),i=e[0];e[1]&&(t=this.getUrlParams(e[1]));var n,o=this.getRoute(i),r={};if(!o)return void location.replace("#/");n=this.getValues(i,o);for(var s=0;s<o.params.length;s++)r[o.params[s]]=n[s];t=$.extend({},r,t),o.handle(t)},i.prototype.getUrlParams=function(t){var e={};if(!t)return e;for(var i,n=t.split("&"),o=0;o<n.length;o++)i=n[o].split("="),e[i[0]]=i[1];return e},i.prototype.map=function(t,e,i){var n,o,r,s=[];if(o=t.replace(/\//g,"\\/"),"function"==typeof e&&(i=e,e=null),e)for(var a in e)n=new RegExp("\\{"+a+"\\}","g"),o=o.replace(n,"("+e[a].replace(/\^/,"").replace(/\$/,"")+")"),s.push(a);for(n=new RegExp("{([^}]+)}","g");null!=(r=n.exec(o));)s.push(r[1]),n.lastIndex;return o="^"+o.replace(/{[^}]+}/gi,"(.+)")+"$",this._routes.push({routeUrl:t,pattern:o,params:s,handle:i||function(){}}),this},i.prototype.getValues=function(t,e){var e,i=[];if(0===t.length)return i;if(e=e||this.getRoute(t),null!=e){var n=t.match(e.pattern);if(0!=n.length)for(var o=1;o<n.length;o++)i.push(n[o])}return i},i.prototype.getRoute=function(t){for(var e=0;e<this._routes.length;e++)if(new RegExp(this._routes[e].pattern).test(t))return this._routes[e];return null},"function"==typeof t.define&&define.amd?define("km/router",[],function(){return i}):t.Router=i}(window),define("km/tooltips",["jquery"],function(t){function e(e,i){this.$element=e,this.options=t.extend({},{delay:0,content:"",tipClass:"",placement:"right",trigger:"hover click",container:document.body},i),this.init()}return e.prototype.init=function(){this.$tips=t('<div class="km-tooltips"><div class="tooltips-arrow"></div><div class="tooltips-title"></div><div class="tooltips-inner"></div></div>'),this.$tips.addClass(this.options.placement).addClass(this.options.tipClass),this.setContent(),this.isShow=!1;for(var e,i=this.options.trigger.split(" "),n=0;n<i.length;n++)if(e=i[n],"click"===e)this.$element.on(e+".km-tooltips",t.proxy(this.toggle,this));else if("manual"!=e){var o="hover"===e?"mouseenter":"focus",r="hover"===e?"mouseleave":"blur";this.$element.on(o,t.proxy(this.show,this)),this.$element.on(r,t.proxy(this.hide,this))}this.options.container?this.$tips.appendTo(this.options.container):this.$tips.insertAfter(this.$element),this.hide()},e.prototype.setContent=function(e){e=t.trim(e||this.options.content),0===e.length&&(e=this.$element.attr("data-content")||"");var i=this.$tips;i.find(".tooltips-inner").html(e)},e.prototype.setPosition=function(){var t=this.getOffset();this.$tips.css(t)},e.prototype.getOffset=function(){var t=this.options.placement,e=(this.options.container,this.$element),i=this.$tips,n=e.offset(),o=e.outerWidth(),r=e.outerHeight(),s=i.outerWidth(),a=i.outerHeight();switch(t){case"left":return{top:n.top+r/2-a/2,left:n.left-s};case"top":return{top:n.top-a,left:n.left+o/2-s/2};case"right":return{top:n.top+r/2-a/2,left:n.left+o};case"bottom":return{top:n.top+r,left:n.left+o/2-s/2}}},e.prototype.show=function(){return 0===t.trim(this.options.content).length?void this.hide():(this.isShow=!0,this.setPosition(),void this.$tips.show().addClass("in"))},e.prototype.hide=function(){this.isShow=!1,this.$tips.hide().removeClass("in")},e.prototype.toggle=function(){this.isShow?this.hide():this.show()},e.Global=function(i){var i=i||t('[data-module="tooltips"]');i.each(function(){var i=t(this),n=e.Get(i);n||(n=new e(i,{title:i.attr("data-title"),content:i.attr("data-content"),placement:i.attr("data-placement"),tipClass:i.attr("data-tipClass"),trigger:i.attr("data-trigger")}),e.Set(i,n))})},e.Get=function(t){return t.data("tooltips")},e.Set=function(t,e){t.data("tooltips",e)},e}),define("km/util",function(){var t={},e=function(){};return t.createProto=Object.__proto__?function(t){return{__proto__:t}}:function(t){return e.prototype=t,new e},t}),define("km/validate",["jquery"],function(t){function e(i,n){this.$form=i,this.options=t.extend({},e.DEFAULTS,n),this.rules=this.options.rules,this.messages=this.options.messages,this.init()}return e.DEFAULTS={errorClass:"error",errorElement:"label",rules:{},messages:{},focusClear:!0,keyupClear:!0,errorPlacement:null},e.prototype.init=function(){this.getValidFields(),0!==this.validFields.count&&this.eventBind()},e.prototype.getValidFields=function(){this.validFields={data:{},count:0};{var e=this;this.$form.find("input,select,textarea").filter(function(){return this.name in e.rules?!0:!1}).each(function(){e.validFields.data[this.name]||(e.validFields.data[this.name]=t(this),e.validFields.count++)})}},e.prototype.eventBind=function(){var t=this;this.$form.on("submit",function(e){return t.validateFrom(e)}).on("focus blur keyup",':text, [type="password"], [type="file"], select, textarea, [type="number"], [type="search"] ,[type="tel"], [type="url"], [type="email"], [type="datetime"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], [type="range"], [type="color"]',function(e){t.validate(e)}).on("click",'[type="radio"], [type="checkbox"], select, option',function(e){t.validate(e)})},e.prototype.validate=function(e){var i,n,o=e.target,r=t(o),s=this.rules[o.name];if(this.options.focusClear&&"focusin"===e.type||this.options.keyupClear&&"keyup"===e.type)return void this.hideError(r);if(s){n=this.elementValue(r);for(var a in s){var u={method:a,parameters:s[a]};if(i=this.methods[a].call(this,n,r,u.parameters),!i)return this.formatAndAdd(o,u),!1;this.hideError(r)}return!0}},e.prototype.validateFrom=function(){var t=this,e=!0;for(var i in this.validFields.data)t.validate({target:this.validFields.data[i][0]})||(e=!1);return e},e.prototype.valid=function(){return this.validateFrom()},e.prototype.checkable=function(t){return/radio|checkbox/i.test(t.type)},e.prototype.formatAndAdd=function(e,i){var n=t(e),o=this.defaultMessage(e,i.method);o=this.format(o,i.parameters),this.showError(n,o)},e.prototype.showError=function(e,i){this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var n=e.data("error");n||(n=t("<"+this.options.errorElement+">").addClass(this.options.errorClass),e.data("error",n)),n.html(i).show(),e.addClass(this.options.errorClass),t.isFunction(this.options.errorPlacement)?this.options.errorPlacement(e,n):n.insertAfter(e)},e.prototype.hideError=function(e){this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var i=e.data("error");e.removeClass(this.options.errorClass),t.isFunction(this.options.errorPlacement)&&this.options.errorPlacement(e,t([])),i&&i.hide()},e.prototype.defaultMessage=function(t,e){return this.messages[t.name]||(this.messages[t.name]={},this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]||(this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]},e.prototype.format=function(e,i){return-1!=e.indexOf("{0}")&&(i.constructor!==Array&&(i=[i]),t.each(i,function(t,i){e=e.replace(new RegExp("\\{"+t+"\\}","g"),function(){return i})})),e},e.prototype.errorMessages={required:"该字段不能为空",email:"电子邮箱格式错误",url:"url格式错误",date:"请输入一个有效日期",dateISO:"请输入一个有效日期（ISO）",mobile:"手机号码格式错误",phone:"电话号码格式错误",number:"请输入一个有效的数字",digits:"请输入正整数",minLength:"请输入一个长度不小于{0}个字符的值",maxLength:"请输入一个长度不大于{0}个字符的值",rangeLength:"请输入一个长度介于{0}到{1}个字符的值",min:"请输入一个大于或等于{0}的值",max:"请输入一个小于或等于{0}的值",range:"请输入一个介于{0}到{1}之间的数值",equalTo:"请再输入一个相同的值",remote:"远程验证失败"},e.prototype.methods={required:function(e,i){if("select"===i[0].nodeName.toLowerCase()){var n=t.trim(i.val());return n&&n.length>0}return this.checkable(i[0])?this.getLength(e,i[0])>0:t.trim(e).length>0},email:function(t,e){return this.optional(e)||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s\d{1,2}[:]\d{1,2}[:]\d{1,2}\w$/.test(t)},mobile:function(t,e){return this.optional(e)||/^((13[0-9])|(15[^4,\\D])|(18[0,5-9]))\d{8}$/.test(t)},phone:function(t,e){return this.optional(e)||/^((0\d{2,3}\-)[1-9]\d{7}(\-\d{1,4})?)$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},minLength:function(e,i,n){var o=t.isArray(e)?e.length:this.getLength(t.trim(e),i[0]);return this.optional(i)||o>=n},maxLength:function(e,i,n){var o=t.isArray(e)?e.length:this.getLength(t.trim(e),i[0]);return this.optional(i)||n>=o},rangeLength:function(e,i,n){var o=t.isArray(e)?e.length:this.getLength(t.trim(e),i[0]);return this.optional(i)||o>=n[0]&&o<=n[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(e,i,n){var i=t(n);return e===this.elementValue(i)},remote:function(e,i,n){var o,r={},s=this,a=this.previousValue(i[0]);return a.old===e?a.valid:(a.old=e,"string"==typeof n?o=n:(o=n.url,r=n.data),r[i[0].name]=e,r.rnd=Math.random(),t.post(o,r).success(function(t){var e=t===!0||"true"===t;e?s.hideError(i):s.showError(i,a.message),a.valid=e}).error(function(){return!1}),!0)}},e.prototype.previousValue=function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})},e.prototype.optional=function(t){var e=this.elementValue(t);return!this.methods.required.call(this,e,t)},e.prototype.elementValue=function(e){var i=e.attr("type"),n=e.val();return"radio"===i||"checkbox"===i?t("input[name='"+e.attr("name")+"']:checked").val():"string"==typeof n?n.replace(/\r/g,""):n},e.prototype.getLength=function(e,i){switch(i.nodeName.toLowerCase()){case"select":return t("option:selected",i).length;case"input":if(this.checkable(i))return this.$form.find("[name='"+i.name+"']").filter(":checked").length}return e.length},e}),define("km/validateTooltips",["jquery","km/validate","km/tooltips","km/util"],function(t,e,i,n){var o=function(t,i){e.call(this,t,i)};return o.prototype=n.createProto(e.prototype),o.prototype.getTipsPlacement=function(t){var e=t.name,i="bottom";return this.tipsPlacement||(this.tipsPlacement=this.options.tipsPlacement||{}),this.tipsPlacement[e]?i=this.tipsPlacement[e]:this.tipsPlacement[e]=i,i},o.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var n=this.getTipsPlacement(t[0]),o=i.Get(t);o?o.setContent(e):(o=new i(t,{content:e,tipClass:"danger",trigger:"manual",placement:n}),i.Set(t,o)),o.show(),t.addClass(this.options.errorClass)},o.prototype.hideError=function(t){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var e=i.Get(t);e&&e.hide(),t.removeClass(this.options.errorClass)},o}),define("km",["km/app","km/loading","km/popTips","km/router","km/tooltips","km/util","km/validate","km/validateTooltips"],function(t,e,i,n,o,r,s,a){return{App:t,loading:e,popTips:i,Router:n,Tooltips:o,util:r,Validate:s,ValidateTooltips:a}});